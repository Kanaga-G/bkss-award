<!DOCTYPE html>
<html>
<head>
    <title>JSON Data to SQL Converter - Bankass Awards</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; margin-bottom: 30px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; background: #fafafa; }
        h2 { color: #555; margin-bottom: 15px; }
        textarea { width: 100%; height: 150px; margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 12px; }
        .button-group { display: flex; gap: 10px; flex-wrap: wrap; margin: 15px 0; }
        button { background: #007bff; color: white; padding: 12px 20px; border: none; cursor: pointer; border-radius: 5px; font-weight: bold; transition: background 0.3s; }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.success:hover { background: #1e7e34; }
        button.warning { background: #ffc107; color: #333; }
        button.warning:hover { background: #e0a800; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        .output { background: #f8f9fa; padding: 20px; border-radius: 5px; white-space: pre-wrap; font-family: 'Courier New', monospace; font-size: 12px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; }
        .stats { background: #e9ecef; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .stat-item { text-align: center; padding: 10px; background: white; border-radius: 5px; }
        .stat-number { font-size: 24px; font-weight: bold; color: #007bff; }
        .stat-label { font-size: 12px; color: #666; }
        .instructions { background: #d1ecf1; padding: 15px; border-radius: 5px; border-left: 4px solid #0c5460; margin: 20px 0; }
        .error { background: #f8d7da; padding: 15px; border-radius: 5px; border-left: 4px solid #721c24; margin: 10px 0; color: #721c24; }
        .success { background: #d4edda; padding: 15px; border-radius: 5px; border-left: 4px solid #155724; margin: 10px 0; color: #155724; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ Tables + Data SQL Converter</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            GÃ©nÃ©rez les CREATE TABLE et transformez vos donnÃ©es JSON en INSERT SQL pour Supabase<br>
            <small>SÃ©paration complÃ¨te : crÃ©ation des tables + import des donnÃ©es</small>
        </p>
        
        <div class="instructions">
            <h3>ğŸ“‹ Instructions</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <h4>ğŸ—ï¸ Ã‰tape A: CrÃ©ation des Tables</h4>
                    <ol>
                        <li>Cliquez sur "ğŸ—ï¸ GÃ©nÃ©rer CREATE TABLE"</li>
                        <li>Copiez le SQL de crÃ©ation des tables</li>
                        <li>ExÃ©cutez-le d'abord dans Supabase</li>
                        <li>VÃ©rifiez que tout est crÃ©Ã©</li>
                    </ol>
                </div>
                <div>
                    <h4>ğŸ“¥ Ã‰tape B: Import des DonnÃ©es</h4>
                    <ol>
                        <li>Collez votre JSON ci-dessous</li>
                        <li>Cliquez sur "ğŸ”„ GÃ©nÃ©rer INSERT DATA"</li>
                        <li>Copiez le SQL des donnÃ©es</li>
                        <li>ExÃ©cutez-le aprÃ¨s la crÃ©ation</li>
                    </ol>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                <strong>âš ï¸ Important:</strong> ExÃ©cutez TOUJOURS la crÃ©ation des tables en premier !
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ—ï¸ Section A: CrÃ©ation des Tables</h2>
            <div class="button-group">
                <button onclick="generateAllTables()" class="success">ğŸ—ï¸ GÃ©nÃ©rer CREATE TABLE</button>
                <button onclick="generateUsersTable()" class="primary">ğŸ‘¥ Users Table</button>
                <button onclick="generateCategoriesTable()" class="primary">ğŸ­ Categories Table</button>
                <button onclick="generateCandidatesTable()" class="primary">ğŸ¤ Candidates Table</button>
                <button onclick="generateVotesTable()" class="primary">ğŸ—³ï¸ Votes Table</button>
                <button onclick="generateNotificationsTable()" class="primary">ğŸ”” Notifications Table</button>
                <button onclick="generateAdminMessagesTable()" class="warning">ğŸ“¨ Admin Messages Table</button>
                <button onclick="generateVotingConfigTable()" class="warning">âš™ï¸ Voting Config Table</button>
            </div>
            <div id="tablesOutput" class="output" style="background: #f0f8ff; border-color: #007bff;">Le SQL de crÃ©ation des tables apparaÃ®tra ici...</div>
            <div class="button-group">
                <button onclick="copyTablesSQL()" class="success">ğŸ“‹ Copier CREATE TABLE</button>
                <button onclick="clearTablesSQL()" class="danger">ğŸ—‘ï¸ Effacer</button>
                <button onclick="downloadTablesSQL()" class="primary">ğŸ’¾ TÃ©lÃ©charger</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“‹ Ã‰tape 1: Collez votre JSON (pour les donnÃ©es)</h2>
            <textarea id="jsonInput" placeholder="Collez ici votre fichier JSON complet..."></textarea>
            <div id="jsonError" class="error" style="display: none;"></div>
        </div>
        
        <div class="section">
            <h2>ï¿½ Section B: Import des DonnÃ©es</h2>
            <div class="button-group">
                <button onclick="convertAll()" class="success">ğŸ”„ GÃ©nÃ©rer INSERT DATA</button>
                <button onclick="convertUsers()" class="primary">ğŸ‘¥ Users Data</button>
                <button onclick="convertCategories()" class="primary">ğŸ­ Categories Data</button>
                <button onclick="convertCandidates()" class="primary">ğŸ¤ Candidates Data</button>
                <button onclick="convertVotes()" class="primary">ğŸ—³ï¸ Votes Data</button>
                <button onclick="convertNotifications()" class="primary">ğŸ”” Notifications Data</button>
                <button onclick="convertAdminMessages()" class="warning">ğŸ“¨ Admin Messages Data</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š Statistiques des DonnÃ©es</h2>
            <div id="stats" class="stats" style="display: none;">
                <div class="stats-grid" id="statsGrid">
                    <!-- Stats will be populated here -->
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“‹ Ã‰tape 2: SQL des DonnÃ©es GÃ©nÃ©rÃ©</h2>
            <div id="sqlOutput" class="output">Le SQL des donnÃ©es apparaÃ®tra ici...</div>
            <div class="button-group">
                <button onclick="copySQL()" class="success">ğŸ“‹ Copier INSERT DATA</button>
                <button onclick="clearSQL()" class="danger">ğŸ—‘ï¸ Effacer</button>
                <button onclick="downloadSQL()" class="primary">ğŸ’¾ TÃ©lÃ©charger</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“‹ Ã‰tape 3: ExÃ©cution dans Supabase</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div style="padding: 15px; background: #d4edda; border-radius: 5px; border-left: 4px solid #28a745;">
                    <h4>âœ… Section A - Tables</h4>
                    <ol>
                        <li>Allez sur <a href="https://supabase.com/dashboard" target="_blank">Supabase Dashboard</a></li>
                        <li>SÃ©lectionnez votre projet Bankass Awards</li>
                        <li>Allez dans "SQL Editor"</li>
                        <li>Collez le SQL de crÃ©ation des tables</li>
                        <li>Cliquez sur "Run" - VÃ©rifiez que tout est crÃ©Ã©</li>
                    </ol>
                </div>
                <div style="padding: 15px; background: #cce5ff; border-radius: 5px; border-left: 4px solid #004085;">
                    <h4>ğŸ“¥ Section B - DonnÃ©es</h4>
                    <ol>
                        <li>Restez dans le mÃªme "SQL Editor"</li>
                        <li>Collez le SQL des donnÃ©es (INSERT)</li>
                        <li>Cliquez sur "Run" pour insÃ©rer les donnÃ©es</li>
                        <li>VÃ©rifiez les statistiques d'import</li>
                    </ol>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: #f8d7da; border-radius: 5px; border-left: 4px solid #721c24;">
                <strong>ğŸš¨ Ordre Important:</strong> ExÃ©cutez TOUJOURS les CREATE TABLE avant les INSERT DATA !
            </div>
        </div>
    </div>

<script>
let currentData = null;

// ========================================
// ğŸ—ï¸ FONCTIONS DE GÃ‰NÃ‰RATION DES TABLES
// ========================================

function generateAllTables() {
    let sql = '-- ğŸ—ï¸ CRÃ‰ATION COMPLÃˆTE DES TABLES - BANKASS AWARDS\n';
    sql += `-- GÃ©nÃ©rÃ© le: ${new Date().toISOString()}\n\n`;
    
    sql += generateUsersTableSQL();
    sql += generateCategoriesTableSQL();
    sql += generateCandidatesTableSQL();
    sql += generateVotesTableSQL();
    sql += generateNotificationsTableSQL();
    sql += generateAdminMessagesTableSQL();
    sql += generateVotingConfigTableSQL();
    
    sql += '-- ========================================\n';
    sql += '-- âœ… Toutes les tables crÃ©Ã©es avec succÃ¨s !\n';
    sql += '-- ğŸš€ PrÃªt pour l\'import des donnÃ©es\n';
    sql += '-- ========================================\n';
    
    document.getElementById('tablesOutput').textContent = sql;
}

function generateUsersTable() {
    document.getElementById('tablesOutput').textContent = generateUsersTableSQL();
}

function generateCategoriesTable() {
    document.getElementById('tablesOutput').textContent = generateCategoriesTableSQL();
}

function generateCandidatesTable() {
    document.getElementById('tablesOutput').textContent = generateCandidatesTableSQL();
}

function generateVotesTable() {
    document.getElementById('tablesOutput').textContent = generateVotesTableSQL();
}

function generateNotificationsTable() {
    document.getElementById('tablesOutput').textContent = generateNotificationsTableSQL();
}

function generateAdminMessagesTable() {
    document.getElementById('tablesOutput').textContent = generateAdminMessagesTableSQL();
}

function generateVotingConfigTable() {
    document.getElementById('tablesOutput').textContent = generateVotingConfigTableSQL();
}

// Fonctions SQL individuelles
function generateUsersTableSQL() {
    return `-- ğŸ‘¥ TABLE USERS
CREATE TABLE IF NOT EXISTS users (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    role VARCHAR(50) DEFAULT 'VOTER' CHECK (role IN ('VOTER', 'SUPER_ADMIN')),
    phone VARCHAR(50),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_users_role ON users(role);

`;
}

function generateCategoriesTableSQL() {
    return `-- ğŸ­ TABLE CATEGORIES
CREATE TABLE IF NOT EXISTS categories (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_categories_name ON categories(name);

`;
}

function generateCandidatesTableSQL() {
    return `-- ğŸ¤ TABLE CANDIDATES
CREATE TABLE IF NOT EXISTS candidates (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    bio TEXT,
    image_url TEXT,
    audio_file TEXT,
    candidate_song VARCHAR(255),
    category_id UUID REFERENCES categories(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_candidates_category_id ON candidates(category_id);

`;
}

function generateVotesTableSQL() {
    return `-- ğŸ—³ï¸ TABLE VOTES
CREATE TABLE IF NOT EXISTS votes (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    category_id UUID REFERENCES categories(id) ON DELETE CASCADE,
    candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    UNIQUE(user_id, category_id) -- Un vote par utilisateur par catÃ©gorie
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_votes_user_id ON votes(user_id);
CREATE INDEX IF NOT EXISTS idx_votes_category_id ON votes(category_id);

`;
}

function generateNotificationsTableSQL() {
    return `-- ğŸ”” TABLE NOTIFICATIONS
CREATE TABLE IF NOT EXISTS notifications (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    type VARCHAR(50) DEFAULT 'info' CHECK (type IN ('info', 'warning', 'success', 'error')),
    read BOOLEAN DEFAULT false,
    admin_message_id UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_notifications_user_id ON notifications(user_id);
CREATE INDEX IF NOT EXISTS idx_notifications_read ON notifications(read);

`;
}

function generateAdminMessagesTableSQL() {
    return `-- ğŸ“¨ TABLE ADMIN_MESSAGES
CREATE TABLE IF NOT EXISTS admin_messages (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    message TEXT NOT NULL,
    type VARCHAR(50) DEFAULT 'info' CHECK (type IN ('info', 'warning', 'success', 'error')),
    target_users TEXT DEFAULT 'all',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index pour optimisation
CREATE INDEX IF NOT EXISTS idx_admin_messages_created_at ON admin_messages(created_at DESC);

`;
}

function generateVotingConfigTableSQL() {
    return `-- âš™ï¸ TABLE VOTING_CONFIG
CREATE TABLE IF NOT EXISTS voting_config (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    is_voting_open BOOLEAN DEFAULT false,
    block_message TEXT DEFAULT 'Les votes ne sont pas encore ouverts.',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

`;
}

// Fonctions pour la section tables
function copyTablesSQL() {
    const sqlText = document.getElementById('tablesOutput').textContent;
    if (!sqlText || sqlText === 'Le SQL de crÃ©ation des tables apparaÃ®tra ici...') {
        alert('âŒ Aucun SQL de tables Ã  copier');
        return;
    }
    
    navigator.clipboard.writeText(sqlText).then(() => {
        alert('âœ… SQL des tables copiÃ© dans le presse-papiers !');
    }).catch(err => {
        alert('âŒ Erreur lors de la copie: ' + err);
    });
}

function clearTablesSQL() {
    document.getElementById('tablesOutput').textContent = 'Le SQL de crÃ©ation des tables apparaÃ®tra ici...';
}

function downloadTablesSQL() {
    const sqlText = document.getElementById('tablesOutput').textContent;
    if (!sqlText || sqlText === 'Le SQL de crÃ©ation des tables apparaÃ®tra ici...') {
        alert('âŒ Aucun SQL de tables Ã  tÃ©lÃ©charger');
        return;
    }
    
    const blob = new Blob([sqlText], { type: 'text/sql' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bankass_create_tables_${new Date().toISOString().split('T')[0]}.sql`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// ========================================
// ğŸ“¥ FONCTIONS DE CONVERSION DES DONNÃ‰ES
// ========================================

function validateJSON() {
    const jsonInput = document.getElementById('jsonInput').value;
    const jsonError = document.getElementById('jsonError');
    
    if (!jsonInput.trim()) {
        jsonError.style.display = 'none';
        return false;
    }
    
    try {
        currentData = JSON.parse(jsonInput);
        jsonError.style.display = 'none';
        showStats();
        return true;
    } catch (e) {
        jsonError.textContent = 'âŒ Erreur JSON: ' + e.message;
        jsonError.style.display = 'block';
        currentData = null;
        hideStats();
        return false;
    }
}

function showStats() {
    if (!currentData) return;
    
    const stats = document.getElementById('stats');
    const statsGrid = document.getElementById('statsGrid');
    
    const statsData = [
        { label: 'ğŸ‘¥ Users', count: currentData.users ? currentData.users.length : 0 },
        { label: 'ğŸ­ Categories', count: currentData.categories ? currentData.categories.length : 0 },
        { label: 'ğŸ¤ Candidates', count: currentData.candidates ? currentData.candidates.length : 0 },
        { label: 'ğŸ—³ï¸ Votes', count: currentData.votes ? currentData.votes.length : 0 },
        { label: 'ğŸ”” Notifications', count: currentData.notifications ? currentData.notifications.length : 0 },
        { label: 'ğŸ“¨ Admin Messages', count: currentData.admin_messages ? currentData.admin_messages.length : 0 }
    ];
    
    statsGrid.innerHTML = statsData.map(stat => `
        <div class="stat-item">
            <div class="stat-number">${stat.count}</div>
            <div class="stat-label">${stat.label}</div>
        </div>
    `).join('');
    
    stats.style.display = 'block';
}

function hideStats() {
    document.getElementById('stats').style.display = 'none';
}

function escapeSQL(str) {
    if (!str) return '';
    return String(str).replace(/'/g, "''");
}

function convertUsers() {
    if (!validateJSON()) return;
    
    const users = currentData.users || [];
    if (users.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ‘¥ Aucun utilisateur Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ‘¥ Import des Users\n';
    sql += 'INSERT INTO users (id, name, email, role, phone, created_at, updated_at) VALUES\n';
    
    const values = users.map(user => 
        `('${user.id}', '${escapeSQL(user.name)}', '${user.email}', '${user.role}', '${escapeSQL(user.phone || '')}', '${user.created_at}', '${user.updated_at}')`
    );
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertCategories() {
    if (!validateJSON()) return;
    
    const categories = currentData.categories || [];
    if (categories.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ­ Aucune catÃ©gorie Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ­ Import des Categories\n';
    sql += 'INSERT INTO categories (id, name, description, created_at, updated_at) VALUES\n';
    
    const values = categories.map(cat => 
        `('${cat.id}', '${escapeSQL(cat.name)}', '${escapeSQL(cat.description || '')}', '${cat.created_at}', '${cat.updated_at}')`
    );
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertCandidates() {
    if (!validateJSON()) return;
    
    const candidates = currentData.candidates || [];
    if (candidates.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ¤ Aucun candidat Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ¤ Import des Candidates\n';
    sql += 'INSERT INTO candidates (id, name, bio, image_url, audio_file, candidate_song, category_id, created_at, updated_at) VALUES\n';
    
    const values = candidates.map(candidate => 
        `('${candidate.id}', '${escapeSQL(candidate.name)}', '${escapeSQL(candidate.bio || '')}', '${escapeSQL(candidate.image_url || '')}', '${escapeSQL(candidate.audio_file || '')}', '${escapeSQL(candidate.candidate_song || '')}', '${candidate.category_id}', '${candidate.created_at}', '${candidate.updated_at}')`
    );
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertVotes() {
    if (!validateJSON()) return;
    
    const votes = currentData.votes || [];
    if (votes.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ—³ï¸ Aucun vote Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ—³ï¸ Import des Votes\n';
    sql += 'INSERT INTO votes (id, user_id, category_id, candidate_id, created_at, updated_at) VALUES\n';
    
    const values = votes.map(vote => 
        `('${vote.id}', '${vote.user_id}', '${vote.category_id}', '${vote.candidate_id}', '${vote.created_at}', '${vote.updated_at}')`
    );
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertNotifications() {
    if (!validateJSON()) return;
    
    const notifications = currentData.notifications || [];
    if (notifications.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ”” Aucune notification Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ”” Import des Notifications\n';
    sql += 'INSERT INTO notifications (id, user_id, title, message, type, read, admin_message_id, created_at, updated_at) VALUES\n';
    
    const values = notifications.map(notif => {
        const readValue = notif.read ? 'true' : 'false';
        const adminMsgId = notif.admin_message_id ? `'${notif.admin_message_id}'` : 'NULL';
        return `('${notif.id}', '${notif.user_id}', '${escapeSQL(notif.title)}', '${escapeSQL(notif.message)}', '${notif.type}', ${readValue}, ${adminMsgId}, '${notif.created_at}', '${notif.updated_at}')`;
    });
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertAdminMessages() {
    if (!validateJSON()) return;
    
    const adminMessages = currentData.admin_messages || [];
    if (adminMessages.length === 0) {
        document.getElementById('sqlOutput').textContent = '-- ğŸ“¨ Aucun message admin Ã  importer';
        return;
    }
    
    let sql = '-- ğŸ“¨ Import des Admin Messages\n';
    sql += 'INSERT INTO admin_messages (id, title, message, type, target_users, created_at, updated_at) VALUES\n';
    
    const values = adminMessages.map(msg => 
        `('${msg.id}', '${escapeSQL(msg.title)}', '${escapeSQL(msg.message)}', '${msg.type}', '${escapeSQL(msg.target_users || 'all')}', '${msg.created_at}', '${msg.updated_at}')`
    );
    
    sql += values.join(',\n');
    sql += ';\n\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

function convertAll() {
    if (!validateJSON()) return;
    
    let sql = '-- ï¿½ IMPORT COMPLET DES DONNÃ‰ES - BANKASS AWARDS\n';
    sql += `-- GÃ©nÃ©rÃ© le: ${new Date().toISOString()}\n`;
    sql += '-- ATTENTION: ExÃ©cutez les CREATE TABLE avant ce script !\n\n';
    
    // Ordre d'import important pour respecter les foreign keys
    const tables = [
        { name: 'categories', converter: convertCategoriesData, icon: 'ğŸ­' },
        { name: 'users', converter: convertUsersData, icon: 'ğŸ‘¥' },
        { name: 'candidates', converter: convertCandidatesData, icon: 'ğŸ¤' },
        { name: 'votes', converter: convertVotesData, icon: 'ğŸ—³ï¸' },
        { name: 'notifications', converter: convertNotificationsData, icon: 'ğŸ””' },
        { name: 'admin_messages', converter: convertAdminMessagesData, icon: 'ğŸ“¨' }
    ];
    
    tables.forEach(table => {
        const tableData = currentData[table.name] || [];
        if (tableData.length > 0) {
            sql += table.converter(tableData);
        }
    });
    
    // Statistiques
    sql += '-- ========================================\n';
    sql += '-- ğŸ“Š Statistiques de l\'Import\n';
    sql += '-- ========================================\n';
    tables.forEach(table => {
        const count = (currentData[table.name] || []).length;
        sql += `-- ${table.icon} ${table.name}: ${count} enregistrements\n`;
    });
    sql += '\n-- âœ… Import des donnÃ©es terminÃ© avec succÃ¨s !\n';
    sql += '-- ğŸš€ PrÃªt pour l\'exÃ©cution dans Supabase\n';
    
    document.getElementById('sqlOutput').textContent = sql;
}

// Fonctions de conversion pour le mode "tout"
function convertCategoriesData(categories) {
    let sql = '-- ğŸ­ Categories\n';
    sql += 'INSERT INTO categories (id, name, description, created_at, updated_at) VALUES\n';
    const values = categories.map(cat => 
        `('${cat.id}', '${escapeSQL(cat.name)}', '${escapeSQL(cat.description || '')}', '${cat.created_at}', '${cat.updated_at}')`
    );
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function convertUsersData(users) {
    let sql = '-- ğŸ‘¥ Users\n';
    sql += 'INSERT INTO users (id, name, email, role, phone, created_at, updated_at) VALUES\n';
    const values = users.map(user => 
        `('${user.id}', '${escapeSQL(user.name)}', '${user.email}', '${user.role}', '${escapeSQL(user.phone || '')}', '${user.created_at}', '${user.updated_at}')`
    );
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function convertCandidatesData(candidates) {
    let sql = '-- ğŸ¤ Candidates\n';
    sql += 'INSERT INTO candidates (id, name, bio, image_url, audio_file, candidate_song, category_id, created_at, updated_at) VALUES\n';
    const values = candidates.map(candidate => 
        `('${candidate.id}', '${escapeSQL(candidate.name)}', '${escapeSQL(candidate.bio || '')}', '${escapeSQL(candidate.image_url || '')}', '${escapeSQL(candidate.audio_file || '')}', '${escapeSQL(candidate.candidate_song || '')}', '${candidate.category_id}', '${candidate.created_at}', '${candidate.updated_at}')`
    );
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function convertVotesData(votes) {
    let sql = '-- ğŸ—³ï¸ Votes\n';
    sql += 'INSERT INTO votes (id, user_id, category_id, candidate_id, created_at, updated_at) VALUES\n';
    const values = votes.map(vote => 
        `('${vote.id}', '${vote.user_id}', '${vote.category_id}', '${vote.candidate_id}', '${vote.created_at}', '${vote.updated_at}')`
    );
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function convertNotificationsData(notifications) {
    let sql = '-- ğŸ”” Notifications\n';
    sql += 'INSERT INTO notifications (id, user_id, title, message, type, read, admin_message_id, created_at, updated_at) VALUES\n';
    const values = notifications.map(notif => {
        const readValue = notif.read ? 'true' : 'false';
        const adminMsgId = notif.admin_message_id ? `'${notif.admin_message_id}'` : 'NULL';
        return `('${notif.id}', '${notif.user_id}', '${escapeSQL(notif.title)}', '${escapeSQL(notif.message)}', '${notif.type}', ${readValue}, ${adminMsgId}, '${notif.created_at}', '${notif.updated_at}')`;
    });
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function convertAdminMessagesData(adminMessages) {
    let sql = '-- ğŸ“¨ Admin Messages\n';
    sql += 'INSERT INTO admin_messages (id, title, message, type, target_users, created_at, updated_at) VALUES\n';
    const values = adminMessages.map(msg => 
        `('${msg.id}', '${escapeSQL(msg.title)}', '${escapeSQL(msg.message)}', '${msg.type}', '${escapeSQL(msg.target_users || 'all')}', '${msg.created_at}', '${msg.updated_at}')`
    );
    sql += values.join(',\n');
    sql += ';\n\n';
    return sql;
}

function copySQL() {
    const sqlText = document.getElementById('sqlOutput').textContent;
    if (!sqlText || sqlText === 'Le SQL apparaÃ®tra ici...') {
        alert('âŒ Aucun SQL Ã  copier');
        return;
    }
    
    navigator.clipboard.writeText(sqlText).then(() => {
        alert('âœ… SQL copiÃ© dans le presse-papiers !');
    }).catch(err => {
        alert('âŒ Erreur lors de la copie: ' + err);
    });
}

function clearSQL() {
    document.getElementById('sqlOutput').textContent = 'Le SQL apparaÃ®tra ici...';
}

function downloadSQL() {
    const sqlText = document.getElementById('sqlOutput').textContent;
    if (!sqlText || sqlText === 'Le SQL apparaÃ®tra ici...') {
        alert('âŒ Aucun SQL Ã  tÃ©lÃ©charger');
        return;
    }
    
    const blob = new Blob([sqlText], { type: 'text/sql' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bankass_data_import_${new Date().toISOString().split('T')[0]}.sql`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Validation automatique du JSON quand on tape
document.getElementById('jsonInput').addEventListener('input', function() {
    clearTimeout(this.validationTimeout);
    this.validationTimeout = setTimeout(validateJSON, 1000);
});

// Validation au chargement si du texte est dÃ©jÃ  prÃ©sent
window.addEventListener('load', function() {
    const jsonInput = document.getElementById('jsonInput');
    if (jsonInput.value.trim()) {
        validateJSON();
    }
});
</script>
</body>
</html>
